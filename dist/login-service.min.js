!function(){"use strict";var a=angular.module("eha.login-service",["eha.login-service-adaptor.service","eha.login-service.service"]);"undefined"!=typeof module&&module.exports&&(module.exports=a)}(),function(){"use strict";var a=angular.module("eha.login-service-adaptor-pouchdb.config",["pouchdb"]);a.config(["POUCHDB_METHODS",function(a){a.upsert="qify"}]),"undefined"!=typeof module&&module.exports&&(module.exports=a)}(),function(){"use strict";var a=angular.module("eha.login-service-adaptor-pouchdb.service",["pouchdb","eha.login-service-adaptor-pouchdb.config"]);a.service("ehaLoginServiceAdaptorPouchDB",["pouchDB",function(a){var b=a("eha-login-service"),c="_local/eha-login-service";this.setItem=function(a,d){function e(b){return b[a]=d,b}return b.upsert(c,e).then(function(){return d})},this.getItem=function(a){function d(b){return b[a]}function e(a){if(a&&404!==a.status)throw a;return!1}return b.get(c).then(d)["catch"](e)},this.removeItem=function(a){function d(b){return b._id?(delete b[a],b):!1}return b.upsert(c,d)}}]),"undefined"!=typeof module&&module.exports&&(module.exports=a)}(),function(){"use strict";var a=angular.module("eha.login-service-adaptor.service",["eha.login-service-adaptor-pouchdb.service"]);a.service("ehaLoginServiceAdaptor",["ehaLoginServiceAdaptorPouchDB",function(a){this.setItem=a.setItem,this.getItem=a.getItem,this.removeItem=a.removeItem}]),"undefined"!=typeof module&&module.exports&&(module.exports=a)}(),function(){"use strict";var a=angular.module("eha.login-service.service",["pouchdb","eha.login-service-adaptor.service"]).provider("ehaLoginService",function(){var a=null;this.config=function(b){a=b},this.$get=["$q","$window","pouchDB","ehaLoginServiceAdaptor",function(b,c,d,e){var f=this,g=function(){var a=c.prompt("Username?"),d=c.prompt("Password?");return b.when([a,d])};f.config=function(a){if("function"!=typeof a)throw new Error("notification service must be a function that returns a promise");g=a};var h,i=function(){if(!a){var b=["loginService must be configured with:\n",".config(function (ehaLoginServiceProvider) {","  // Full URL to a CouchDB, including an existing DB",'  var url = "https://couchdb.example.com/db"',"  ehaLoginServiceProvider.config(url)","})"].join("\n");throw new Error(b)}return h=h||d(a)},j=e.setItem,k=e.getItem,l=e.removeItem,m=function(a,c){var d=[j("username",a),j("password",c)];return b.all(d)},n=function(){return b.all([k("username"),k("password")])},o=function(){return n().then(function(a){return!(!a[0]||!a[1])})};return f.getUserName=k.bind(null,"username"),f.maybeShowLoginUi=function(){return o().then(function(a){return a?n():g().then(function(a){return m.apply(null,a)}).then(n)})},f.hasLocalCreds=function(){return o()},f.login=function(a,b){var c=m.bind(null,a,b);return i().login(a,b).then(c)},f.renew=function(){return o().then(function(a){return a?n().then(function(a){return f.login(a[0],a[1])}):b.reject({status:401,message:"credentials not found"})})},f.logout=function(){return b.all([l("username"),l("password")])},f.storeCredentials=function(a,b){return m(a,b)},f}]});"undefined"!=typeof module&&module.exports&&(module.exports=a)}();